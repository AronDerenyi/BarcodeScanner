<!DOCTYPE html>
<html lang="en">

	<head>

		<meta charset="utf-8">

		<title>Made by Aron</title>

	</head>

	<body style="background: black;">

		<video id="video" autoplay style="
			width: 100vw;
			height: 100vh;
			position: fixed;
			top: 0;
			left: 0;
			background: black;"></video>

		<!--<div style="-->
			<!--width: 100vw;-->
			<!--height: 0;-->
			<!--position: fixed;-->
			<!--top: 50%;-->
			<!--left: 0;-->
			<!--border: 1px solid rgba(255, 0, 0, 1);-->
			<!--mix-blend-mode: lighten"></div>-->

		<canvas id="canvas" style="
			position: fixed;
			width: 100vw;
			top: 50%;
			left: 0;
			transform: scaleY(5)"></canvas>

	</body>

</html>

<script>
	var video = document.getElementById("video");
//	var canvas = document.createElement("canvas");
	var canvas = document.getElementById("canvas");
	var context = canvas.getContext("2d");

	if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
		navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
			video.src = window.URL.createObjectURL(stream);
			video.play();
			loop();
		});
	}

	function loop() {
		if (video.videoWidth > 0 && video.videoHeight > 0) parse();
		setTimeout(loop, 200);
	}

	function parse() {
		var width = video.videoWidth;
		var height = video.videoHeight;
		var i;

		canvas.width = width;
		canvas.height = 1;

		// Retrieving the middle row of pixels from the video
		context.drawImage(video, 0, -height / 2, width, height);
		var imageData = context.getImageData(0, 0, width, 1).data;
		var data = [];

		// Creating gray scale
		for (i = 0; i < width; i++) {
			var r = imageData[i * 4] / 255.0;
			var g = imageData[i * 4 + 1] / 255.0;
			var b = imageData[i * 4 + 2] / 255.0;
			data[i] = r * 0.299 + g * 0.587 + b * 0.114;
		}

		// Averaging together the neighbouring pixels by the factor (1 : 3 : 1)
		var originalData = data.slice();
		for (i = 0; i < width; i++) {
			var o1 = i > 0 ? originalData[i - 1] : 0;
			var o2 = originalData[i];
			var o3 = i < width - 1 ? originalData[i + 1] : 0;
			data[i] = (o1 + o2 * 3 + o3) / 5;
		}

		// Clamping pixel values to 1 or 0 based on average
		var average = 0.0;
		for (i = 0; i < width; i++) average += data[i];
		average /= width;
		for (i = 0; i < width; i++) data[i] = data[i] > average ? 1 : 0;

		// Drawing for debugging
		for (i = 0; i < width; i++) {
			context.fillStyle = "rgb(" + data[i] * 255 + ", 0, 0)";
			context.fillRect(i, 0, 1, 1);
		}
	}
</script>
